image: 
  name: gcr.io/kaniko-project/executor:v1.14.0-debug
  entrypoint: [""]

stages:
  - build

build-spring:
  stage: build
  script:
    - |
      if [[ "$CI_COMMIT_BRANCH" == "docker" ]]; then
        /kaniko/executor --context "./spring" --destination "${CI_REGISTRY_IMAGE}/spring:v0.0.0"
      fi
  only:
    changes:
      - spring/*

build-mysql:
  stage: build
  script:
    - |
      if [[ "$CI_COMMIT_BRANCH" == "docker" ]]; then
        /kaniko/executor --context "./mysql" --destination "${CI_REGISTRY_IMAGE}/mysql:v0.0.0"
      fi
  only:
    changes:
      - mysql/*

build-react:
  stage: build
  script:
    - |
      if [[ "$CI_COMMIT_BRANCH" == "docker" ]]; then
        /kaniko/executor --context "./react" --destination "${CI_REGISTRY_IMAGE}/react:v0.0.0"
      fi
  only:
    changes:
      - react/*